Index: asahi-scripts/first-boot
===================================================================
--- asahi-scripts.orig/first-boot
+++ asahi-scripts/first-boot
@@ -5,6 +5,7 @@ set -e
 
 root_dev=$(findmnt -n -o SOURCE /)
 efi_dev=$(findmnt -n -o SOURCE /boot/efi)
+root_uuid_old=$(findmnt -n -o UUID /)
 
 if [ -e "$root_dev" ]; then
     echo "Randomizing root filesystem UUID..."
@@ -38,4 +39,14 @@ EOF
     echo
 fi
 
+# Ubuntu doesn't ship systemd-firstboot(1), improvise
+systemd-machine-id-setup
+
+# XXX: grub-probe will look for the old UUID, this will keep it happy.
+#      sleep 1 is needed to make sure the new dev exists.
+if [ ! -z "$root_uuid" ]; then
+    sleep 1
+    ln -s "/dev/disk/by-uuid/$(echo "$root_uuid" | cut -d "=" -f2)" "/dev/disk/by-uuid/$root_uuid_old"
+fi
+
 update-grub
